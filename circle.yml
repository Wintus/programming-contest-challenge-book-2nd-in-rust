machine:
  environment:
    CARGO_HOME: $HOME/.cargo
    PATH: $PATH:$CARGO_HOME/bin

dependencies:
  cache_directories:
    - ~/.cargo
    - ~/.rustup
  pre:
    - >- # install rust unless `cargo` exists
      hash cargo 2>/dev/null ||
      curl -sSf https://sh.rustup.rs | sh /dev/stdin -y
    - rustup install stable
    # https://github.com/rust-lang/cargo/issues/3900
    - sed -i 's/github/git-non-exist-hub/g' $HOME/.gitconfig
  override:
    - cargo update

compile:
  override:
    - cargo build

test:
  override:
    - cargo test
